openapi: 3.0.3
info:
  title: Payment Service API - Digital Payment E-Wallet
  version: 1.0.0
  description: |
    API ini digunakan untuk mengelola transaksi pembayaran dalam sistem digital payment e-wallet.
    Service ini menyediakan operasi top-up saldo dan transfer antar pengguna, serta riwayat transaksi.
  contact:
    name: Deazard & Rayhan
    email: support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8002
    description: Server lokal untuk development
  - url: http://localhost:8002/api
    description: Base URL API

tags:
  - name: Health
    description: Endpoint untuk pengecekan kesehatan service
  - name: Transactions
    description: Endpoint untuk manajemen transaksi pembayaran

paths:
  /health:
    get:
      tags:
        - Health
      summary: Pengecekan kesehatan service
      description: Endpoint ini digunakan untuk mengecek apakah Payment Service sedang berjalan dengan baik
      operationId: healthCheck
      responses:
        '200':
          description: Service berjalan dengan baik
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Payment Service is running
                  timestamp:
                    type: string
                    format: date-time
                    example: "2024-01-15T10:30:00.000Z"
                  service:
                    type: string
                    example: payment-service
                  port:
                    type: integer
                    example: 8002

  /api/transactions:
    get:
      tags:
        - Transactions
      summary: Mendapatkan semua data transaksi
      description: Endpoint ini mengembalikan daftar seluruh transaksi yang ada dalam sistem, diurutkan dari yang terbaru
      operationId: getAllTransactions
      responses:
        '200':
          description: Berhasil mendapatkan data transaksi
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Transaction'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/transactions/{id}:
    get:
      tags:
        - Transactions
      summary: Mendapatkan data transaksi berdasarkan ID
      description: Endpoint ini mengembalikan detail informasi transaksi berdasarkan ID yang diberikan
      operationId: getTransactionById
      parameters:
        - $ref: '#/components/parameters/TransactionId'
      responses:
        '200':
          description: Berhasil mendapatkan data transaksi
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Transaction'
        '404':
          $ref: '#/components/responses/TransactionNotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/transactions/topup:
    post:
      tags:
        - Transactions
      summary: Top-up saldo pengguna
      description: |
        Endpoint ini digunakan untuk melakukan top-up (isi ulang) saldo pengguna.
        Minimal jumlah top-up adalah Rp 10.000.
        
        Proses yang dilakukan:
        1. Validasi data input (user_id dan amount)
        2. Validasi minimal amount (10000)
        3. Memanggil User Service untuk menambah saldo
        4. Menyimpan transaksi dengan status 'success'
        5. Menggunakan database transaction untuk memastikan atomicity
      operationId: topup
      requestBody:
        required: true
        description: Data top-up yang akan diproses
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - amount
              properties:
                user_id:
                  type: integer
                  description: ID pengguna yang akan di-top-up
                  example: 1
                  minimum: 1
                amount:
                  type: number
                  format: double
                  description: Jumlah top-up dalam rupiah (minimal 10000)
                  example: 50000
                  minimum: 10000
      responses:
        '200':
          description: Top-up berhasil dilakukan
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Top-up successful
                  data:
                    type: object
                    properties:
                      transaction_id:
                        type: integer
                        example: 1
                      user_id:
                        type: integer
                        example: 1
                      amount:
                        type: number
                        format: double
                        example: 50000.00
                      type:
                        type: string
                        example: topup
                      status:
                        type: string
                        example: success
                      created_at:
                        type: string
                        format: date-time
                        example: "2024-01-15T10:30:00.000Z"
        '422':
          description: Error validasi data
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Validation error
                  errors:
                    type: object
                    properties:
                      user_id:
                        type: string
                        example: User ID is required
                      amount:
                        type: string
                        example: Minimum top-up amount is 10000
        '500':
          description: Gagal melakukan top-up atau update saldo pengguna
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Failed to update user balance

  /api/transactions/transfer:
    post:
      tags:
        - Transactions
      summary: Transfer saldo antar pengguna
      description: |
        Endpoint ini digunakan untuk melakukan transfer saldo dari satu pengguna ke pengguna lain.
        Minimal jumlah transfer adalah Rp 10.000.
        
        Proses yang dilakukan:
        1. Validasi data input (user_id, target_user_id, amount)
        2. Validasi tidak boleh transfer ke diri sendiri
        3. Validasi minimal amount (10000)
        4. Cek keberadaan pengguna pengirim dan penerima
        5. Cek saldo pengirim mencukupi
        6. Kurangi saldo pengirim
        7. Tambah saldo penerima
        8. Simpan transaksi dengan status 'success'
        9. Menggunakan database transaction untuk memastikan atomicity
      operationId: transfer
      requestBody:
        required: true
        description: Data transfer yang akan diproses
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - target_user_id
                - amount
              properties:
                user_id:
                  type: integer
                  description: ID pengguna pengirim
                  example: 1
                  minimum: 1
                target_user_id:
                  type: integer
                  description: ID pengguna penerima
                  example: 2
                  minimum: 1
                amount:
                  type: number
                  format: double
                  description: Jumlah transfer dalam rupiah (minimal 10000)
                  example: 25000
                  minimum: 10000
      responses:
        '200':
          description: Transfer berhasil dilakukan
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Transfer successful
                  data:
                    type: object
                    properties:
                      transaction_id:
                        type: integer
                        example: 2
                      user_id:
                        type: integer
                        description: ID pengguna pengirim
                        example: 1
                      target_user_id:
                        type: integer
                        description: ID pengguna penerima
                        example: 2
                      amount:
                        type: number
                        format: double
                        example: 25000.00
                      type:
                        type: string
                        example: transfer
                      status:
                        type: string
                        example: success
                      created_at:
                        type: string
                        format: date-time
                        example: "2024-01-15T10:30:00.000Z"
        '404':
          description: Pengguna pengirim atau penerima tidak ditemukan
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Sender not found
        '422':
          description: Error validasi atau saldo tidak mencukupi
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Insufficient balance
                  errors:
                    type: object
                    properties:
                      user_id:
                        type: string
                        example: Sender user ID is required
                      target_user_id:
                        type: string
                        example: Cannot transfer to yourself
                      amount:
                        type: string
                        example: Minimum transfer amount is 10000
        '500':
          description: Transfer gagal dilakukan
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Transfer failed

components:
  parameters:
    TransactionId:
      name: id
      in: path
      required: true
      description: ID unik transaksi
      schema:
        type: integer
        minimum: 1
        example: 1

  schemas:
    Transaction:
      type: object
      description: Model data transaksi
      required:
        - user_id
        - type
        - amount
      properties:
        id:
          type: integer
          description: ID unik transaksi (auto-generated)
          example: 1
        user_id:
          type: integer
          description: ID pengguna pengirim/yang melakukan transaksi
          example: 1
        target_user_id:
          type: integer
          description: ID pengguna penerima (untuk transaksi transfer)
          example: 2
          nullable: true
        type:
          type: string
          enum: [topup, transfer]
          description: |
            Jenis transaksi:
            - topup: Top-up saldo
            - transfer: Transfer antar pengguna
          example: transfer
        amount:
          type: number
          format: double
          description: Jumlah transaksi dalam rupiah
          example: 50000.00
        status:
          type: string
          description: |
            Status transaksi:
            - success: Transaksi berhasil
            - failed: Transaksi gagal
            - pending: Transaksi sedang diproses
          example: success
        description:
          type: string
          description: Deskripsi detail transaksi
          example: Transfer from user 1 to user 2
          nullable: true
        created_at:
          type: string
          format: date-time
          description: Waktu transaksi dibuat
          example: "2024-01-15T10:30:00.000Z"
        updated_at:
          type: string
          format: date-time
          description: Waktu terakhir transaksi diperbarui
          example: "2024-01-15T10:30:00.000Z"

    Error:
      type: object
      description: Model response error
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          description: Pesan error
          example: An error occurred
        error:
          type: string
          description: Detail error (hanya muncul di development mode)
          example: Database connection failed

  responses:
    TransactionNotFound:
      description: Transaksi tidak ditemukan
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              message:
                type: string
                example: Transaction not found

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Autentikasi menggunakan JWT token.
        Note: Saat ini dalam mode development, autentikasi tidak diperlukan.
        Untuk production, tambahkan header: Authorization: Bearer {token}

# Note: Security currently disabled in development mode
# Uncomment below to enable JWT authentication for all endpoints
# security:
#   - BearerAuth: []

